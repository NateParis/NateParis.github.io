<!DOCTYPE html>
  
  <head>
  <title>NFL Offensive Play Predictor</title>
  
  <meta charset="utf-8">
    
  <style>
    body {
      background-color: #000435;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
    }
  
  .titleArea {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0;
  }
  
  .vizArea {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
  }
  
  .filterSection {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    padding: 5px;
  }
  
  .dropdown_container1 {
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    margin-right: 35px;
  }
  
  .dropdown1 {
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    margin-right: 135px;
  }
  
  .dropdown1 label {
    display: block;
    font-weight: bold;
    font-size: 20px;
    color: white;
    margin-bottom: 5px;
    height: 40px;
  }
  
  .menu1 select {
    font-size: 15px;
    padding: 0;
    margin-left: 5px;
  }
  
  .dropdown_container2 {
    display: flex;
    flex-direction: row;
    align-items: flex-start;
  }
  
  .dropdown2 {
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    margin-right: 135px;
  }
  
  .dropdown2 label {
    display: block;
    font-weight: bold;
    font-size: 20px;
    color: white;
    margin-bottom: 5px;
    height: 40px;
  }
  
  .menu2 select {
    font-size: 15px;
    padding: 0;
    margin-left: 5px;
  }
  
  .buttons {
    font-size: 20;
  }
  
  .fieldSection {
    display: flex;
    flex-direction: row;
    align-items: center;
    padding: 5px;
  }
  
  .tableArea {
    width: 30%;
  }
  
  .fieldArea {
    width: 70%;
  }
  
  .tooltip{
    display: hidden;
    padding: 0px 10px 0px 10px;
    z-index: 9999;
    background-color: #000435;
    color: #B3A369;
    border: 1px solid white;
    border-radius: 20px;
    opacity: 0.85;
    font-size: 18px;
    position: absolute;
  }
  
  </style>
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Rye&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Keania+One&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Passion+One&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Jockey+One&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Galada&display=swap">
    
    </head>
    
    <body>
    
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.9.1/d3-tip.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.9.1/d3-tip.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.9.1/d3-tip.min.js.map"></script>
    <script type="text/javascript" src="https://d3js.org/d3.v5.min.js"></script>
    <script type="text/javascript" src="https://d3js.org/d3-dsv.v2.min.js"></script>
    
    <div class = 'titleArea'></div>
    
    <div class = 'vizArea'>
     <div class = 'filterSection'>
        <div class = 'dropdown_container1'>
            <div class = 'dropdown1'>
              <label for = 'teamDropdown'>Team:</label>
              <div class = 'menu1'>
                <select id = 'teamDropdown'></select>
              </div>
            </div>
            <div class = 'dropdown1'>
              <label for = 'gameClockDropdown'>Game Clock:</label>
              <div class = 'menu1'>
                <select id = 'gameClockDropdown'></select>
              </div>
            </div>
            <div class = 'dropdown1'>
              <label for = 'quarterDropdown'>Quarter:</label>
              <div class = 'menu1'>
                <select id = 'quarterDropdown'></select>
              </div>
            </div>
            <div class = 'dropdown1'>
              <label for = 'downDropdown'>Down:</label>
              <div class = 'menu1'>
                <select id = 'downDropdown'></select>
              </div>
            </div>            
            <div class = 'dropdown1'>
              <label for = 'distanceDropdown'>Distance:</label>
              <div class = 'menu1'>
                <select id = 'distanceDropdown'></select>
              </div>
            </div>            
            <div class = 'dropdown1'>
              <label for = 'losDropdown'>Line of Scrimmage:</label>
              <div class = 'menu1'>
                <select id = 'losDropdown' value='50'></select>
              </div>
            </div>
          </div>
        <div class = 'dropdown_container2'>
          <div class = 'dropdown2'>
            <label for = 'offHomeAwayDropdown'>Home/Away:</label>
            <div class = 'menu2'>
              <select id = 'offHomeAwayDropdown'></select> 
            </div>
          </div>
          <div class = 'dropdown2'>
            <label for = 'offPointDiffDropdown'>Offensive Point Difference:</label>
            <div class = 'menu2'>
              <select id = 'offPointDiffDropdown'></select>
            </div>
          </div>
          <div class = 'dropdown2'>
            <label for = 'remainingOffTOsDropdown'>Remaining Offensive TOs:</label>
            <div class = 'menu2'>
              <select id = 'remainingOffTOsDropdown'></select>
            </div>
          </div>
          <div class = 'dropdown2'>
            <label for = 'remainingDefTOsDropdown'>Remaining Defensive TOs:</label>
            <div class = 'menu2'>
              <select id = 'remainingDefTOsDropdown'></select>
            </div>
          </div>
        </div>
      </div>
     <div class = 'buttons'>
          <button id = 'filterButton'>Click to Calculate Prediction</button>
          <button id = 'vizButton'>Click to Visualize Prediction</button>
      </div>
     <div class = 'fieldSection'></div>
    </div>
    
    <script>
    
    
    // define the dimensions and margins for the football field chart
    const w = 900,
    h = 400,
    margin = {top: 50, right: 25, bottom: 50, left: 25};
    
    const tablW = 1300 - w
  /////////////////////////////////////////////////////////////////////////////    
    
    // Create title in titleArea of the page
    d3.select('.titleArea')
      .append('h1')
      .attr('id', 'pageTitle')
      .attr('class', 'pageTitle_class')
      .style('color', '#B3A369')
      .style('font-size', '50px')
      .style('text-shadow', '-0.5px -0.5px 0 white, 0.5px -0.5px 0 white')
      .text('NFL Offensive Play Predictor')
  
  /////////////////////////////////////////////////////////////////////////////
  
    // Create table in Table Area of the page
    const tblArea = d3.select('.fieldSection')
                .append("svg")
                .attr("id", "tableArea")
                .attr('class', 'tableArea_class')
                .attr("width", tablW + margin.left + margin.right)
                .attr("height", h + margin.top + margin.bottom)
    
    const tblFootnote = tblArea.append('text')
                  .attr('id', 'tableFootnote')
                  .attr('fill', 'white')
                  .attr('font-size', 15)
                  .attr('x', margin.left - 10)
                  .attr('y', h + 75)
                  .text('(%) = est. chance of given play being called under specified conditions')
    
    const tblBackdrop = tblArea.append('rect')
                 .attr('width', tablW)
                 .attr('height', h)
                 .attr('x', margin.left)
                 .attr('y', margin.top)
                 .attr('fill', 'white')
                 .attr('stroke', '#B3A369')
                 .attr('stroke-width', 10)
                 .attr('fill-opacity', 0.95)
    const tblTitle = tblArea.append('text')
                  .attr('id', 'tableTitle')
                  .attr('class', 'tableTitle_class')
                  .attr('fill', '#B3A369')
                  .attr('stroke', '#B3A369')
                  .attr('font-size', 30)
                  .attr('text-anchor', 'middle')
                  .attr('x', margin.left + tablW / 2 )
                  .attr('y', margin.top*2 +10)
                  .text('Top 3 Predicted Plays')
    const tblSubTitle = tblArea.append('text')
                  .attr('id', 'tableSubTitle')
                  .attr('class', 'tableTitle_class')
                  .attr('fill', '#000435')
                  .attr('stroke', '#000435')
                  .attr('font-size', 40)
                  .attr('text-anchor', 'middle')
                  .attr('x', margin.left + tablW / 2 )
                  .attr('y', margin.top*3 + 10 )
                  .text('')
    
    const tblRow1 = tblArea.append('rect')
                  .attr('width', tablW-margin.left-margin.right)
                  .attr('height', 70)
                  .attr('x', margin.left + margin.left)
                  .attr('y', margin.top*2 + 85)
                  .attr('fill', '#000435')
                  .attr("rx", 20) 
                  .attr("ry", 20)
    const tblRow1Num = tblArea.append('text')
                  .attr('fill', 'white')
                  .attr('font-size', 23)
                  .attr('x', margin.left + 40)
                  .attr('y', 225)
                  .text('1.')
    const tblRow1Text = tblArea.append('text')
                  .attr('id', 'tableRow1Text')
                  .attr('fill', 'white')
                  .attr('font-size', 23)
                  .attr('x', margin.left + 40 + 25)
                  .attr('y', 225)
                  .text('')
    const tblRow2 = tblArea.append('rect')
                  .attr('width', tablW-margin.left-margin.right)
                  .attr('height', 70)
                  .attr('x', margin.left + margin.left)
                  .attr('y', margin.top*2 + 170)
                  .attr('fill', '#000435')
                  .attr("rx", 20) 
                  .attr("ry", 20)
    const tblRow2Num = tblArea.append('text')
                  .attr('fill', 'white')
                  .attr('font-size', 23)
                  .attr('x', margin.left + 40)
                  .attr('y', 225 + 85)
                  .text('2.')
    const tblRow2Text = tblArea.append('text')
                  .attr('id', 'tableRow2Text')
                  .attr('fill', 'white')
                  .attr('font-size', 23)
                  .attr('x', margin.left + 40 + 25)
                  .attr('y', 225 + 85)
                  .text('')
    const tblRow3 = tblArea.append('rect')
                  .attr('width', tablW-margin.left-margin.right)
                  .attr('height', 70)
                  .attr('x', margin.left + margin.left)
                  .attr('y', margin.top*2 + 255)
                  .attr('fill', '#000435')
                  .attr("rx", 20) 
                  .attr("ry", 20)
    const tblRow3Num = tblArea.append('text')
                  .attr('fill', 'white')
                  .attr('font-size', 23)
                  .attr('x', margin.left + 40)
                  .attr('y', 225 + 170)
                  .text('3.')
    const tblRow3Text = tblArea.append('text')
                  .attr('id', 'tableRow3Text')
                  .attr('fill', 'white')
                  .attr('font-size', 23)
                  .attr('x', margin.left + 40 + 25)
                  .attr('y', 225 + 170)
                  .text('')
  
  /////////////////////////////////////////////////////////////////////////////                
    // Create the main svg in the Field Area of the page
    const svg = d3.select('.fieldSection')
                .append("svg")
                .attr("id", "fieldArea")
                .attr('class', 'fieldArea_class')
                .attr("width", w + margin.left + margin.right)
                .attr("height", h + margin.top + margin.bottom)

  /////////////////////////////////////////////////////////////////////////////
    // Define tooltip
    var tooltip = d3.select('body')
                        .append('div')
                        .attr('id', 'tooltip')
                        .attr('class', 'tooltip')

  ///////////////////////////////////////////////////////////////////////////
    // Create All Dropdown Menus, except Team.
    
    //// LOS Dropdown
    const losValues = []
    for (let i = 1; i<=49; i++){ losValues.push(i) }
      losValues.push(50)
    for (let i = -49; i<=-1; i++){ losValues.push(i) }
    losSelector = d3.select('#losDropdown')
                    .style('position', 'absolute')
    losOptions = losSelector.selectAll('option')
                    .data(losValues)
                    .enter().append('option')
                    .attr('value', d => d)
                    .text(d => d)
      
    //// Home Away Dropdown
    const offHomeAwayValues = [
                                 'Home',
                                 'Away'
                                ]
        //console.log(offHomeAwayValues)
    const offHomeAwaySelector = d3.select('#offHomeAwayDropdown')
                                  .style('position', 'absolute')
    const offHomeAwayOptions = offHomeAwaySelector.selectAll('option')
                                                  .data(offHomeAwayValues)
                                                  .enter().append('option')
                                                  .attr('value', d => d)
                                                  .text(d => d)
    //// Quarter Dropdown
    const quarterValues = [
                              '1st',
                              '2nd',
                              '3rd',
                              '4th',
                              'OT'
                            ]
      //console.log(quarterValues)
    const quarterSelector = d3.select('#quarterDropdown')
                              .style('position', 'absolute')
    const quarterOptions = quarterSelector.selectAll('option')
                                          .data(quarterValues)
                                          .enter().append('option')
                                          .attr('value', d => d)
                                          .text(d => d)
    //// Game Clock Dropdown
    const gameClockValues = [
                                '15:00-10:00',
                                '9:59-8:00',
                                '7:59-6:00',
                                '5:59-4:00',
                                '3:59-2:00',
                                '1:59-0:00'
                              ]
      //console.log(gameClockValues)
    const gameClockSelector = d3.select('#gameClockDropdown')
                                .style('position', 'absolute')
    const gameClockOptions = gameClockSelector.selectAll('option')
                                              .data(gameClockValues)
                                              .enter().append('option')
                                              .attr('value', d => d)
                                              .text(d => d)
    //// Remaining Offensive Timeouts Dropdown
    const remainingOffTOsValues = [
                                      3,
                                      2,
                                      1,
                                      0
                                    ]
      //console.log(remainingOffTOsValues)
    const remainingOffTOsSelector = d3.select('#remainingOffTOsDropdown')
                                      .style('position', 'absolute')
    const remainingOffTOsOptions = remainingOffTOsSelector.selectAll('option')
                                                          .data(remainingOffTOsValues)
                                                          .enter().append('option')
                                                          .attr('value', d => d)
                                                          .text(d => d)
    //// Remaining Defensive Timeouts Dropdown
    const remainingDefTOsValues = [
                                      3,
                                      2,
                                      1,
                                      0
                                    ]
      //console.log(remainingDefTOsValues)
    const remainingDefTOsSelector = d3.select('#remainingDefTOsDropdown')
                                      .style('position', 'absolute')
    const remainingDefTOsOptions = remainingDefTOsSelector.selectAll('option')
                                                          .data(remainingDefTOsValues)
                                                          .enter().append('option')
                                                          .attr('value', d => d)
                                                          .text(d => d)
    //// Offensive Point Differential Dropdown
    const offPointDiffValues = [
                                  'up 12-14+',
                                  'up 9-11',
                                  'up 4-8',
                                  'up 1-3',
                                  '0',
                                  'down 1-3',
                                  'down 4-8',
                                  'down 9-11',
                                  'down 12-14+'
                                ]
      //console.log(offPointDiffValues)
    const offPointDiffSelector = d3.select('#offPointDiffDropdown')
                                  .style('position', 'absolute')
    const offPointDiffOptions = offPointDiffSelector.selectAll('option')
                                                    .data(offPointDiffValues)
                                                    .enter().append('option')
                                                    .attr('value', d => d)
                                                    .text(d => d)
    //// Down Dropdown
    const downValues = [
                        1,
                        2,
                        3,
                        4
                        ]
      //console.log(downValues)
    const downSelector = d3.select('#downDropdown')
                          .style('position', 'absolute')
    const downOptions = downSelector.selectAll('option')
                                    .data(downValues)
                                    .enter().append('option')
                                    .attr('value', d => d)
                                    .text(d => d)
    //// Distance Dropdown
    const distanceValues = [
                            '16+',
                            '11-15',
                            '7-10',
                            '4-6',
                            '2-3',
                            '1'
                            ]
      //console.log(distanceValues)
    const distanceSelector = d3.select('#distanceDropdown')
                              .style('position', 'absolute')
    const distanceOptions = distanceSelector.selectAll('option')
                                            .data(distanceValues)
                                            .enter().append('option')
                                            .attr('value', d => d)
     
  //////////////////////////////////////////////////////////////////////////  
  
    // Load team aesthetics data
    d3.dsv(",", "team_data.csv", function (d) {
      return {
        team: d.team,
        primary_hex: d.primary_hex,
        secondary_hex: d.secondary_hex,
        mascot: d.mascot,
        ez_font: d.ez_font,
        logo_path: d.logo_path
      }
    }).then(function (data) {
      
      // Create Team Dropdown
      const teamValues = data.map(d => d.team).sort()
        
      teamSelector = d3.select('#teamDropdown')
                      .style('position', 'absolute')
      teamOptions = teamSelector.selectAll('option')
                      .data(teamValues)
                      .enter().append('option')
                      .attr('value', d => d)
                      .text(d => d)
      
      // Create and outline the football field.
      field = svg.insert('g', ':first-child')
                  .attr('id', 'field')
                  .attr('class', 'field_class')
                  .attr("transform", "translate(" + margin.left + "," + (margin.top - 0) + ")")
      const playSurface = field.append('rect')
                                .attr('id', 'playingSurface')
                                .attr('class', 'playSurface_class')
                                .attr('width', w )
                                .attr('height', h)
                                .attr('fill', '#008000')
                                .attr('opacity', .40)
      const fieldOutline = field.append('g')
                                .attr('id', 'outline')
      const upperSL = fieldOutline.append('line')
                                .attr('id', 'leftSideline')
                                .attr('class', 'outline_class')
                                .attr('y1', -12.5)
                                .attr('x1', 0 - 25)
                                .attr('y2', -12.5)
                                .attr('x2', w + 25)
                                .attr('stroke', 'white')
                                .attr('stroke-width', '25')
      const bottomSL = fieldOutline.append('line')
                                .attr('id', 'rightSideline')
                                .attr('class', 'outline_class')
                                .attr('y1', h + 12.5)
                                .attr('x1', 0 - 25)
                                .attr('y2', h + 12.5)
                                .attr('x2', w + 25)
                                .attr('stroke', 'white')
                                .attr('stroke-width', '25')
      const ltBL = fieldOutline.append('line')
                                  .attr('id', 'plusBackline')
                                  .attr('class', 'outline_class')
                                  .attr('y1', 0)
                                  .attr('x1', - 12.5)
                                  .attr('y2', h)
                                  .attr('x2', - 12.5)
                                  .attr('stroke', 'white')
                                  .attr('stroke-width', '25')
      const rtBL = fieldOutline.append('line')
                                  .attr('id', 'minusBackline')
                                  .attr('class', 'outline_class')
                                  .attr('y1', 0)
                                  .attr('x1', w + 12.5)
                                  .attr('y2', h)
                                  .attr('x2', w + 12.5)
                                  .attr('z', 999)
                                  .attr('stroke', 'white')
                                  .attr('stroke-width', '25')
      
      // Draw yardlines
      const fieldLines = field.append('g')
                              .attr('id', 'fieldLines')
      const plusGL = fieldLines.append('line')
                                .attr('id', 'plusGoalline')
                                .attr('class', 'fieldLines_class')
                                .attr('y1', 0)
                                .attr('x1', 30*(w/360))
                                .attr('y2', h)
                                .attr('x2', 30*(w/360))
                                .attr('stroke', 'white')
                                .attr('stroke-width', '4')
      const minusGL = fieldLines.append('line')
                                .attr('id', 'minusGoalline')
                                .attr('class', 'fieldLines_class')
                                .attr('y1', 0)
                                .attr('x1', w - 30*(w/360))
                                .attr('y2', h)
                                .attr('x2', w - 30*(w/360))
                                .attr('stroke', 'white')
                                .attr('stroke-width', '4')
      for (let i = 0; i < 19; i++) {
        var x = 30*(w/360) + (15 * (w/360)) + i * (15 * (w/360))
        var ydLine = fieldLines.append('line')
                              .attr('id', 'yardLine')
                              .attr('class', 'fieldLines_class')
                              .attr('y1', 0)
                              .attr('x1', x)
                              .attr('y2', h)
                              .attr('x2', x)
                              .attr('stroke', 'white')
                              .attr('stroke-width', '2')
      }
      
      // Draw hashmarks
      const hashes = field.append('g')
                        .attr('id', 'hashmarks')
      for (let i = 0; i < 99; i++) {
        var x = 30*(w/360) + 3*(w/360) + i * 3*(w/360)
        var upperSLHash = hashes.append('line')
                            .attr('id', 'hash')
                            .attr('class', 'hashmark_class')
                            .attr('y1', (0 + .5)*(w/360))
                            .attr('x1', x)
                            .attr('y2', (2 + .5)*(w/360))
                            .attr('x2', x)
                            .attr('stroke', 'white')
                            .attr('stroke-width', '2')
      }
      for (let i = 0; i < 99; i++) {
        var x = 30*(w/360) + 3*(w/360) + i * 3*(w/360)
        var upperMidHash = hashes.append('line')
                            .attr('id', 'hash')
                            .attr('class', 'hashmark_class')
                            .attr('y1', (0 + 70.75)*(w/360))
                            .attr('x1', x)
                            .attr('y2', (2 + 70.75)*(w/360))
                            .attr('x2', x)
                            .attr('stroke', 'white')
                            .attr('stroke-width', '2')
      }
      for (let i = 0; i < 99; i++) {
        var x = 30*(w/360) + 3*(w/360) + i * 3*(w/360)
        var lowerMidHash = hashes.append('line')
                            .attr('id', 'hash')
                            .attr('class', 'hashmark_class')
                            .attr('y1', h - (0 + .5)*(w/360))
                            .attr('x1', x)
                            .attr('y2', h - (2 + .5)*(w/360))
                            .attr('x2', x)
                            .attr('stroke', 'white')
                            .attr('stroke-width', '2')
      }
      for (let i = 0; i < 99; i++) {
        var x = 30*(w/360) + 3*(w/360) + i * 3*(w/360)
        var lowerSLHash = hashes.append('line')
                            .attr('id', 'hash')
                            .attr('class', 'hashmark_class')
                            .attr('y1', h - (0 + 70.75)*(w/360))
                            .attr('x1', x)
                            .attr('y2', h - (2 + 70.75)*(w/360))
                            .attr('x2', x)
                            .attr('stroke', 'white')
                            .attr('stroke-width', '2')
      }
      
      // Draw numbers
      const numbs = field.append('g')
                        .attr('id', 'numbers')
      for (let i = 1; i<=5; i++) {
        var x = 30*(w/360) + i * 30*(w/360) - 4
        var upperLtNumber = numbs.append('text')
                                .attr('id', 'yardLineNumber')
                                .attr('class', 'numbers_class')
                                .attr('text-anchor', 'middle')
                                .attr('x', x)
                                .attr('y', 33*(w/360))
                                .text(i*10)
                                .attr('fill', 'white')
                                .attr('font-size', "'"+6*(w/360)+"'")
                                .attr('font-family', 'Galada')
                                .attr('letter-spacing', '9px')
                                .attr('transform', 'rotate(180 '+x+' '+33*(w/360)+')')
      }
      for (let i = 4; i>0; i--) {
        var x = w/2 + (5-i) * 30*(w/360) - 4
        var upperRtNumber = numbs.append('text')
                                .attr('id', 'yardLineNumber')
                                .attr('class', 'numbers_class')
                                .attr('text-anchor', 'middle')
                                .attr('x', x)
                                .attr('y', 33*(w/360))
                                .text(i*10)
                                .attr('fill', 'white')
                                .attr('font-size', "'"+6*(w/360)+"'")
                                .attr('font-family', 'Galada')
                                .attr('letter-spacing', '9px')
                                .attr('transform', 'rotate(180 '+x+' '+33*(w/360)+')')
      }
      for (let i = 1; i<=5; i++) {
        var x = 30*(w/360) + i * 30*(w/360) + 4
        var lowerLtNumber = numbs.append('text')
                              .attr('id', 'yardLineNumber')
                              .attr('class', 'numbers_class')
                              .attr('text-anchor', 'middle')
                              .attr('x', x)
                              .attr('y', h - 33*(w/360))
                              .text(i*10)
                              .attr('fill', 'white')
                              .attr('font-size', "'"+6*(w/360)+"'")
                              .attr('font-family', 'Galada')
                              .attr('letter-spacing', '9px')
      }
      for (let i = 4; i>0; i--) {
        var x = w/2 + (5-i) * 30*(w/360) + 4
        var lowerRtNumber = numbs.append('text')
                                .attr('id', 'yardLineNumber')
                                .attr('class', 'numbers_class')
                                .attr('text-anchor', 'middle')
                                .attr('x', x)
                                .attr('y', h - 33*(w/360))
                                .text(i*10)
                                .attr('fill', 'white')
                                .attr('font-size', "'"+6*(w/360)+"'")
                                .attr('font-family', 'Galada')
                                .attr('letter-spacing', '9px')
      }
      
      
      // Define function to change field logos
      function changeTeamLogos(selectedTeam){
        // Define variables
        var primary_hex = selectedTeam.primary_hex
        var secondary_hex = selectedTeam.secondary_hex
        var mascot = selectedTeam.mascot
        var ez_font = selectedTeam.ez_font
        var logo_path = selectedTeam.logo_path
        
        const teamMarks = field.append('g')
                              .attr('id', 'teamFieldMarkings')
        
        // Draw the midfield logo
        var teamLogo = new Image()
        teamLogo.src = logo_path
        teamLogo.onload = function() {
          var teamLogoWidth = this.width
          var teamLogoHeight = this.height
          var mfLogo = teamMarks.append('image')
                                .attr('id', 'midfieldLogo')
                                .attr('class', 'fieldEndZone_class')
                                .attr('xlink:href', logo_path)
                                .attr('x', (w - (160/3)*(w/360)) / 2 )
                                .attr('y', (h - (160/3)*(w/360)) / 2)
                                .attr('width', (160/3)*(w/360))
                                .attr('opacity', 0.60)
        }
        
        // Paint end zones
        const leftEZ = teamMarks.append('rect')
                              .attr('id', 'plusEndZone')
                              .attr('class', 'fieldEndZone_class')
                              .attr('height', h )
                              .attr('width', 30*(w/360))
                              .attr('fill', primary_hex)
                              .attr('opacity', 0.60)
        const rightEZ = teamMarks.append('rect')
                                .attr('id', 'minusEndZone')
                                .attr('class', 'fieldEndZone_class')
                                .attr('height', h )
                                .attr('width', 30*(w/360))
                                .attr('fill', primary_hex)
                                .attr("transform", "translate(" + (w - 30*(w/360)) + ", 0)")
                                .attr('opacity', 0.60)
        
        // Write team names in endzones
        const leftEZText = teamMarks.append('text')
                                  .attr('id', 'plusEndZoneText')
                                  .attr('class', 'fieldEndZone_class')
                                  .attr('text-anchor', 'middle')
                                  .attr('y', h/2 + 55)
                                  .attr('x', 30*(w/360)/2 + (22 * (w/360))/3 + 15 )
                                  .text(mascot)
                                  .attr('stroke', 'white')
                                  .attr('fill', secondary_hex)
                                  .attr('font-size', '56.6')
                                  .attr('font-family', ez_font)
                                  .attr('transform', 'rotate(-90 ' + (30*(w/360) / 2) + ' ' + ((h/2)+35) + ')')
                                  .attr('opacity', 0.60)
        const rightEZText = teamMarks.append('text')
                                    .attr('id', 'minusEndZoneText')
                                    .attr('class', 'fieldEndZone_class')
                                    .attr('text-anchor', 'middle')
                                    .attr('y', h/2 + 55)
                                    .attr('x', w - (30*(w/360)/2 + (22 * (w/360))/3 +15) )
                                    .text(mascot)
                                    .attr('stroke', 'white')
                                    .attr('fill', secondary_hex)
                                    .attr('font-size', '56.6')
                                    .attr('font-family', ez_font)
                                    .attr('transform', 'rotate(90 ' + (w-(30*(w/360)/2)) + ' ' + ((h/2)+35) + ')')
                                    .attr('opacity', 0.60)
        
      }
      
      // Define function to place the offense
      function placeOffense(selectedLOS, selectedTeam){
        var no_data = {
                       Team: '',
                       play_type: '',
                       direction: '',
                       gap_zone: '',
                       probability: ''
                      }
        
        // Define variables
        var primary_hex = selectedTeam.primary_hex
        var secondary_hex = selectedTeam.secondary_hex
        
        // Place the LOS
        if (selectedLOS < 0) {
          var x = (margin.left - 50) + (10*3 + (-1*selectedLOS)*3)*(w/360) + (3.3 * 3)*(w/360)
        } else {
          var x = (margin.left - 50) + (10*3 + (100 - selectedLOS)*3)*(w/360)+ (3.3 * 3)*(w/360)
        }
        
        // Draw the Passing Zones
        const zones = field.append('g')
                            .attr('id', 'passingZones')
        const leftScreen = zones.append('rect')
                              .attr('id', 'left_screen')
                              .attr('class', 'offense_class')
                              .attr('x', x - 15 * (w/360) )
                              .attr('y', 0)
                              .attr('width', 15 * (w/360))
                              .attr('height', (160/3)*(w/360))
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '2')
                              .attr('fill-opacity', .01)
                              .data([no_data])
        const leftShort = zones.append('rect')
                              .attr('id', 'left_short')
                              .attr('class', 'offense_class')
                              .attr('x', x)
                              .attr('y', 0)
                              .attr('width', 30 * (w/360))
                              .attr('height', (160/3)*(w/360))
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '2')
                              .attr('fill-opacity', .01)
                              .data([no_data])
        const leftIntermediate = zones.append('rect')
                              .attr('id', 'left_intermediate')
                              .attr('class', 'offense_class')
                              .attr('x', x + 30 * (w/360))
                              .attr('y', 0)
                              .attr('width', 30 * (w/360))
                              .attr('height', (160/3)*(w/360))
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '2')
                              .attr('fill-opacity', .01)
                              .data([no_data])
        const leftLong = zones.append('rect')
                              .attr('id', 'left_long')
                              .attr('class', 'offense_class')
                              .attr('x', x + 60 * (w/360))
                              .attr('y', 0)
                              .attr('width', 45 * (w/360))
                              .attr('height', (160/3)*(w/360))
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '2')
                              .attr('fill-opacity', .01)
                              .data([no_data])
        const leftDeep = zones.append('rect')
                              .attr('id', 'left_deep')
                              .attr('class', 'offense_class')
                              .attr('x', x + 105 * (w/360))
                              .attr('y', 0)
                              .attr('width', 45 * (w/360))
                              .attr('height', (160/3)*(w/360))
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '2')
                              .attr('fill-opacity', .01)
                              .data([no_data])
        const midScreen = zones.append('rect')
                              .attr('id', 'middle_screen')
                              .attr('class', 'offense_class')
                              .attr('x', x - 15 * (w/360) )
                              .attr('y', (160/3)*(w/360))
                              .attr('width', 15 * (w/360))
                              .attr('height', (160/3)*(w/360))
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '2')
                              .attr('fill-opacity', .01)
                              .data([no_data])
        const midShort = zones.append('rect')
                              .attr('id', 'middle_short')
                              .attr('class', 'offense_class')
                              .attr('x', x)
                              .attr('y', (160/3)*(w/360))
                              .attr('width', 30 * (w/360))
                              .attr('height', (160/3)*(w/360))
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '2')
                              .attr('fill-opacity', .01)
                              .data([no_data])
        const midIntermediate = zones.append('rect')
                              .attr('id', 'middle_intermediate')
                              .attr('class', 'offense_class')
                              .attr('x', x + 30 * (w/360))
                              .attr('y', (160/3)*(w/360))
                              .attr('width', 30 * (w/360))
                              .attr('height', (160/3)*(w/360))
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '2')
                              .attr('fill-opacity', .01)
                              .data([no_data])
        const midLong = zones.append('rect')
                              .attr('id', 'middle_long')
                              .attr('class', 'offense_class')
                              .attr('x', x + 60 * (w/360))
                              .attr('y', (160/3)*(w/360))
                              .attr('width', 45 * (w/360))
                              .attr('height', (160/3)*(w/360))
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '2')
                              .attr('fill-opacity', .01)
                              .data([no_data])
        const midDeep = zones.append('rect')
                              .attr('id', 'middle_deep')
                              .attr('class', 'offense_class')
                              .attr('x', x + 105 * (w/360))
                              .attr('y', (160/3)*(w/360))
                              .attr('width', 45 * (w/360))
                              .attr('height', (160/3)*(w/360))
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '2')
                              .attr('fill-opacity', .01)
                              .data([no_data])
        const rightScreen = zones.append('rect')
                              .attr('id', 'right_screen')
                              .attr('class', 'offense_class')
                              .attr('x', x - 15 * (w/360) )
                              .attr('y', h - (160/3)*(w/360))
                              .attr('width', 15 * (w/360))
                              .attr('height', (160/3)*(w/360))
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '2')
                              .attr('fill-opacity', .01)
                              .data([no_data])
        const rightShort = zones.append('rect')
                              .attr('id', 'right_short')
                              .attr('class', 'offense_class')
                              .attr('x', x)
                              .attr('y', h - (160/3)*(w/360))
                              .attr('width', 30 * (w/360))
                              .attr('height', (160/3)*(w/360))
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '2')
                              .attr('fill-opacity', .01)
                              .data([no_data])
        const rightIntermediate = zones.append('rect')
                              .attr('id', 'right_intermediate')
                              .attr('class', 'offense_class')
                              .attr('x', x + 30 * (w/360))
                              .attr('y', h - (160/3)*(w/360))
                              .attr('width', 30 * (w/360))
                              .attr('height', (160/3)*(w/360))
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '2')
                              .attr('fill-opacity', .01)
                              .data([no_data])
        const rightLong = zones.append('rect')
                              .attr('id', 'right_long')
                              .attr('class', 'offense_class')
                              .attr('x', x + 60 * (w/360))
                              .attr('y', h - (160/3)*(w/360))
                              .attr('width', 45 * (w/360))
                              .attr('height', (160/3)*(w/360))
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '2')
                              .attr('fill-opacity', .01)
                              .data([no_data])
        const rightDeep = zones.append('rect')
                              .attr('id', 'right_deep')
                              .attr('class', 'offense_class')
                              .attr('x', x + 105 * (w/360))
                              .attr('y', h - (160/3)*(w/360))
                              .attr('width', 45 * (w/360))
                              .attr('height', (160/3)*(w/360))
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '2')
                              .attr('fill-opacity', .01)
                              .data([no_data])
                              
        // Draw the LOS
        los = field.append('line')
                  .attr('id', 'lineOfScrimmage')
                  .attr('class', 'los_class')
                  .attr('x1', x )
                  .attr('y1', 0 )
                  .attr('x2', x )
                  .attr('y2', h )
                  .attr('stroke', 'yellow')
                  .attr('stroke-width', '4')
                  
        // Draw the Offensive Players
        const offense = field.append('g')
                            .attr('id', 'offensivePlayers')
        const center = offense.append('circle')
                              .attr('id', 'middle_center')
                              .attr('class', 'offense_class')
                              .attr('cx', x-4)
                              .attr('cy', h/2)
                              .attr('r', 5)
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '3')
                              .attr('fill-opacity', .01)
                              .data([no_data])
        const leftGuard = offense.append('circle')
                              .attr('id', 'left_guard')
                              .attr('class', 'offense_class')
                              .attr('cx', x-10)
                              .attr('cy', h/2 - 6*(w/360))
                              .attr('r', 5)
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '3')
                              .attr('fill-opacity', .01)
                              .data([no_data])
        const rightGuard = offense.append('circle')
                              .attr('id', 'right_guard')
                              .attr('class', 'offense_class')
                              .attr('cx', x-10)
                              .attr('cy', h/2 + 6*(w/360))
                              .attr('r', 5)
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '3')
                              .attr('fill-opacity', .01)
                              .data([no_data])
        const leftTackle = offense.append('circle')
                              .attr('id', 'left_tackle')
                              .attr('class', 'offense_class')
                              .attr('cx', x-10)
                              .attr('cy', h/2 - 12*(w/360))
                              .attr('r', 5)
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '3')
                              .attr('fill-opacity', .01)
                              .data([no_data])
        const rightTackle = offense.append('circle')
                              .attr('id', 'right_tackle')
                              .attr('class', 'offense_class')
                              .attr('cx', x-10)
                              .attr('cy', h/2 + 12*(w/360))
                              .attr('r', 5)
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '3')
                              .attr('fill-opacity', .01)
                              .data([no_data])
        const leftEnd = offense.append('circle')
                              .attr('id', 'left_end')
                              .attr('class', 'offense_class')
                              .attr('cx', x-10)
                              .attr('cy', h/2 - 24*(w/360))
                              .attr('r', 5)
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '3')
                              .attr('fill-opacity', .01)
                              .data([no_data])
        const rightEnd = offense.append('circle')
                              .attr('id', 'right_end')
                              .attr('class', 'offense_class')
                              .attr('cx', x-10)
                              .attr('cy', h/2 + 24*(w/360))
                              .attr('r', 5)
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '3')
                              .attr('fill-opacity', .01)
                              .data([no_data])
        const kicker = offense.append('circle')
                              .attr('id', 'kicker')
                              .attr('class', 'offense_class')
                              .attr('cx', x - 21*(w/360))
                              .attr('cy', h/2 - 6*(w/360))
                              .attr('r', 5)
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '3')
                              .attr('fill-opacity', .01)
                              .data([no_data])
        const punter = offense.append('circle')
                              .attr('id', 'punter')
                              .attr('class', 'offense_class')
                              .attr('cx', x - 30*(w/360))
                              .attr('cy', h/2)
                              .attr('r', 5)
                              .attr('fill', secondary_hex)
                              .attr('stroke', primary_hex)
                              .attr('stroke-width', '3')
                              .attr('fill-opacity', .01)
                              .data([no_data])
      }
      
      
      // Update probabilities and Top3 Table on filterButton click
      let predictedPlays = []
      d3.select('#filterButton').on('click', function() {
            
        // Remove old visulization
        d3.select('#teamFieldMarkings').remove()
        d3.select('#lineOfScrimmage').remove()
        d3.select('#offensivePlayers').remove()
        d3.select('#passingZones').remove()
      
        // Log all current filter selections
        const selectedTeam = d3.select('#teamDropdown').node().value
        const selectedQuarter = d3.select('#quarterDropdown').node().value
        const selectedDown = parseInt(d3.select('#downDropdown').node().value)
        const selectedDistance = d3.select('#distanceDropdown').node().value
        const selectedLOS = parseInt(d3.select('#losDropdown').node().value)
        const selectedHomeAway = d3.select('#offHomeAwayDropdown').node().value
        const selectedPointDiff = d3.select('#offPointDiffDropdown').node().value
        const selectedClock = d3.select('#gameClockDropdown').node().value
        const selectedOffTOs = parseInt(d3.select('#remainingOffTOsDropdown').node().value)
        const selectedDefTOs = parseInt(d3.select('#remainingDefTOsDropdown').node().value)
        
      
        // Convert all ranged filter selections to ordinal responses
        //// Quarter -> ordinal
        let selectedQuarterOrdinal  = ''
        if ( selectedQuarter == 'OT' ){
              selectedQuarterOrdinal = 5
        } else if ( selectedQuarter == '4th' ){
              selectedQuarterOrdinal = 4
        } else if ( selectedQuarter == '3rd' ){
              selectedQuarterOrdinal = 3
        } else if ( selectedQuarter == '2nd' ){
              selectedQuarterOrdinal = 2
        } else {
              selectedQuarterOrdinal = 1
        }
        
        //// Distance -> selectedLOSOrdinal
        let selectedDistanceOrdinal  = ''
        if ( selectedDistance == '16+' ){
              selectedDistanceOrdinal = 6
        } else if ( selectedDistance == '11-15' ){
              selectedDistanceOrdinal = 5
        } else if ( selectedDistance == '7-10' ){
              selectedDistanceOrdinal = 4
        } else if ( selectedDistance == '4-6' ){
              selectedDistanceOrdinal = 3
        } else if ( selectedDistance == '2-3' ){
              selectedDistanceOrdinal = 2
        } else {
              selectedDistanceOrdinal = 1
        }
        
        //// LOS -> ordinal
        let selectedLOSOrdinal = ''
        if ( selectedLOS <= -1 && selectedLOS >= -5 ){
              selectedLOSOrdinal = 8
        } else if ( selectedLOS <= -6 && selectedLOS >= -14 ){
              selectedLOSOrdinal = 7
        } else if ( selectedLOS <= -15 && selectedLOS >= -39 ){
              selectedLOSOrdinal = 6
        } else if ( (selectedLOS <= -40 && selectedLOS >= -49) || 
                    (selectedLOS <= 50 && selectedLOS >= 36)  ){
              selectedLOSOrdinal = 5
        } else if ( selectedLOS <= 35 && selectedLOS >= 21 ){
              selectedLOSOrdinal = 4
        } else if ( selectedLOS <= 20 && selectedLOS >= 11 ){
              selectedLOSOrdinal = 3
        } else if ( selectedLOS <= 10 && selectedLOS >= 6 ){
              selectedLOSOrdinal = 2
        } else {
              selectedLOSOrdinal = 1
        }
          
        //// Point Difference -> ordinal
        let selectedPointDiffOrdinal  = ''
        if ( selectedPointDiff == 'up 12-14+' ){
              selectedPointDiffOrdinal = 9
        } else if ( selectedPointDiff == 'up 9-11' ){
              selectedPointDiffOrdinal = 8
        } else if ( selectedPointDiff == 'up 4-8' ){
              selectedPointDiffOrdinal = 7
        } else if (selectedPointDiff  == 'up 1-3' ){
              selectedPointDiffOrdinal = 6
        } else if ( selectedPointDiff == '0' ){
              selectedPointDiffOrdinal  = 5
        } else if ( selectedPointDiff == 'down 1-3' ){
              selectedPointDiffOrdinal = 4
        } else if ( selectedPointDiff == 'down 4-8' ){
              selectedPointDiffOrdinal = 3
        } else if ( selectedPointDiff == 'down 9-11' ){
              selectedPointDiffOrdinal = 2
        } else {
              selectedPointDiffOrdinal = 1
        }
        
        //// Clock -> ordinal
        let selectedClockOrdinal = ''
        if ( selectedClock == '15:00-10:00' ){
              selectedClockOrdinal = 6
        } else if ( selectedClock == '9:59-8:00' ){
              selectedClockOrdinal = 5
        } else if ( selectedClock == '7:59-6:00' ){
              selectedClockOrdinal = 4
        } else if ( selectedClock == '5:59-4:00' ){
              selectedClockOrdinal = 3
        } else if ( selectedClock == '3:59-2:00' ){
              selectedClockOrdinal = 2
        } else {
              selectedClockOrdinal = 1
        }
        
        
        // Create a dict that maps filter selections to model features
        const filterData = {
          posteam: selectedTeam,
          posteam_type: selectedHomeAway,
          qtr: selectedQuarterOrdinal,
          down: selectedDown,
          posteam_timeouts_remaining: selectedOffTOs,
          defteam_timeouts_remaining: selectedDefTOs,
          game_clock: selectedClockOrdinal,
          distance: selectedDistanceOrdinal,
          los: selectedLOSOrdinal,
          point_diff: selectedPointDiffOrdinal
        }
        const requestData = {input_data: filterData};
        
      
        // Send a POST request to the Flask API
        fetch('https://cse6242project-4c0f1b9aa8d4.herokuapp.com/predict', {
          method: 'POST',
          headers: {
                  'Content-type': 'application/json',
                 },
          body: JSON.stringify(requestData),
        })
        .then((response) => response.json())
        .then((data) => {
          // Process API response
          const playList = data.predicted_plays
            //console.log(playList)
          const probsList = data.predicted_probs[0]
            //console.log(probsList)
      
          // Create predictedPlays dataframe  
          //// Deconstruct each play in playList into {play_type, direction, gap_zone}
          var playTypeArray = new Array()
          var sideOfFieldArray = new Array()
          var gapZoneArray = new Array()
          playList.forEach(play => {
            var separatedString = play.split(',')
             playTypeArray.push(separatedString[0]) 
             sideOfFieldArray.push(separatedString[1])
             gapZoneArray.push(separatedString[2])
          })
            
          //// Combining {playTypeArray, sideOfFieldArray, gapZoneArray, probsList}
          for (let i=0; i<probsList.length; i++){
            const row = {
              play_type: playTypeArray[i],
              direction: sideOfFieldArray[i],
              gap_zone: gapZoneArray[i],
              prob: probsList[i]
            }
            predictedPlays.push(row)
          }
            console.log(predictedPlays)
            
          // Update the tooltip
          tooltipData = predictedPlays.map(d => ({
                          play_type: d.play_type,
                          direction: d.direction,
                          gap_zone: d.gap_zone,
                          prob: d.prob
                        }))
            console.log(tooltipData) 
            
          // Gather table information
          const top3Table = tooltipData.sort((a,b) => b.prob - a.prob).slice(0,3)
            console.log(top3Table)
          tblInfo = new Array()
          top3Table.forEach(d =>
              tblInfo.push(d.play_type + 
                          ": " + 
                          d.direction + 
                          " " +
                          d.gap_zone +
                          " (" +
                          (d3.format(".2f")(d.prob)*100).toFixed(0) +
                          "%)")
          )
              
          // Update Table
          d3.select('#tableSubTitle').text(d3.select('#teamDropdown').node().value)         
          d3.select('#tableRow1Text').text(tblInfo[0])
          d3.select('#tableRow2Text').text(tblInfo[1])
          d3.select('#tableRow3Text').text(tblInfo[2])
        }).catch(function (error) {
          console.log(error)
        })
      })
      
      
      // Create offense based on Selected LOS and Selected Team
      d3.select('#vizButton').on('click', function() {
        const selectedLOS = parseInt(d3.select('#losDropdown').node().value)
        const selectedTeamName = d3.select('#teamDropdown').node().value
        const selectedTeam = data.find(d => d.team === selectedTeamName)
        
        // Place Team Logo and End Zones
        if ( selectedTeam ) {
          d3.select('#teamFieldMarkings').remove()
          changeTeamLogos(selectedTeam)
        }
        
        // Place Offense with adjusted radii and opacity
        if ( !isNaN(selectedLOS) && selectedTeam ){
          d3.select('#lineOfScrimmage').remove()
          d3.select('#offensivePlayers').remove()
          d3.select('#passingZones').remove()
          placeOffense(selectedLOS, selectedTeam)
        }
        
        // Extract prediction probabilities and update the visualization
        predictedPlays.forEach(d => {
          if (d.play_type === 'kick' || d.play_type === 'punt'){
            var new_data = {
                          Team: selectedTeamName,
                          play_type: d.play_type,
                          probability: d.prob
                         }
          } else {
            var new_data = {
                          Team: selectedTeamName,
                          play_type: d.play_type,
                          direction: d.side_of_field,
                          gap_zone: d.run_gap + " " + d.pass_depth,
                          probability: d.prob
                         }
          }
          
          
          new_opacity = d.prob ** (1/3)
          
          if (d.prob >= 0.20){
            new_radius = 5 * (d.prob * (100/14))
          } else {
            new_radius = 5
          }
          
          // Update opacity, radius, and data
          if (d.play_type === 'pass') {
            playZone = d.side_of_field+'_'+d.pass_depth
            d3.select('#'+playZone).attr('fill-opacity', new_opacity)
                                   .data([new_data])
          } else if (d.play_type === 'run'){
            playGap = d.side_of_field+'_'+d.run_gap
            d3.select('#'+playGap).attr('r', new_radius)
                                  .attr('fill-opacity', new_opacity)
                                   .data([new_data])
          } else if (d.play_type === 'kick'){
            d3.select('#kicker').attr('r', new_radius)
                                .attr('fill-opacity', new_opacity)
                                   .data([new_data])
          } else {
            d3.select('#punter').attr('r', new_radius)
                                .attr('fill-opacity', new_opacity)
                                   .data([new_data])
          }
        })
        
        // Create Tooltip features for Players/Zones
        d3.selectAll('.offense_class').on('mouseover', function(event, d){
                  if ( d3.select(this).datum().play_type == 'kick' || d3.select(this).datum().play_type == 'punt' ){
                    tooltipInfo = 
                      `
                        <p><strong>Team:</strong> ${d3.select(this).datum().Team}</p>
                        <p><strong>Play Type:</strong> ${d3.select(this).datum().play_type}</p>
                        <p><strong>Probability:</strong> ${d3.format(".5f")(d3.select(this).datum().probability)}</p>
                      `
                  } else {
                    tooltipInfo = 
                      `
                        <p><strong>Team:</strong> ${d3.select(this).datum().Team}</p>
                        <p><strong>Play Type:</strong> ${d3.select(this).datum().play_type}</p>
                        <p><strong>Direction:</strong> ${d3.select(this).datum().direction}</p>
                        <p><strong>Gap/Zone:</strong> ${d3.select(this).datum().gap_zone}</p>
                        <p><strong>Probability:</strong> ${d3.format(".5f")(d3.select(this).datum().probability)}</p>
                      `
                  }
                  tooltip.style('visibility', 'visible')
                         .html(tooltipInfo)
                 })
                 .on('mousemove', function(event){
                    tooltip.style('top', (d3.event.pageY -200) + 'px')
                           .style('left', (d3.event.pageX - 200)  + 'px')
                 })
                 .on('mouseout', function(){
                     tooltip.style('visibility', 'hidden');
                 });  
        }) 
        
      
      // Set Dropdown Defaults
      teamSelector.property('value', 'SF')
      losSelector.property('value', '-48')
      offHomeAwaySelector.property('value', 'Home')
      quarterSelector.property('value', '3rd')
      gameClockSelector.property('value', '7:59-6:00')
      remainingOffTOsSelector.property('value', '3')
      remainingDefTOsSelector.property('value', '2')
      offPointDiffSelector.property('value', 'up 1-3')
      downSelector.property('value', '1')
      distanceSelector.property('value', '4-6')  
    
    })
    .catch(function (error) {
      console.log(error);
    });
    
      
  </script>
    
    </body>
    